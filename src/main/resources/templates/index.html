<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:th="https://www.thymeleaf.org" xmlns:sec="https://www.thymeleaf.org/thymeleaf-extras-springsecurity3">
<head>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js" integrity="sha384-oBqDVmMz9ATKxIep9tiCxS/Z9fNfEXiDAYTujMAeBAsjFuCZSmKbSSUnQlmh/jp3" crossorigin="anonymous"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-GLhlTQ8iRABdZLl6O3oVMWSktQOp6b7In1Zl3/Jr59b6EGGoI1aFkw7cmDA6j6gD" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js" integrity="sha384-w76AqPfDkMBDXo30jS1Sgez6pr3x5MlQ1ZAGC+nuZB+EYdgRZgiwxhTBTkF7CXvN" crossorigin="anonymous"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.3/jquery.min.js"></script>

    <title>Spring Security Example</title>
    <script type="text/javascript">

        function showUsers() {
            $.get('/users', function (data) {
                console.log()

                let table = "<table border='1px'><tr><td>ID</td><td>name</td><td>last</td></tr>";

                for (i = 0; i < data.length; i++) {
                    table = table + "<tr><td>" + data[i].id + "</td><td>" + data[i].firstName + "</td><td>" + data[i].lastName + "</td><td><input type=\"button\" onclick=\"eventUser()\" id=\"elem\" value=\"Event\" /></td></tr>"
                }

                table = table + "</table>";

                $("#test_user").html(table)
            });
        }

        // It's works
        let id = 37
        function showOneUsers(userId) {
            let id = userId;
            $.get('/users', function (data) {
                console.log("showOneUsers")


                let user_60

                for (i = 0; i < data.length;) {
                    console.log("i = " + i)
                    if (data[i].id === id) {
                        user_60 = data[i]
                        break
                    } else {
                        i++
                    }
                }

                console.log(user_60)
                console.log(user_60.id)
                console.log(user_60.firstName)

            });
        }

        $(document).ready(function () {
            showUsers()
            // showOneUsers(id)


            elem.onclick = function (event) {
                // вывести тип события, элемент и координаты клика
                console.log(event.type + " on " + event.currentTarget)
                console.log("Coordinate is " + event.clientX + ":" + event.clientY )
                console.log(event)
                console.log("id = " + event.target.id)
                console.log("class = " + event.target.className)
                let number = Number(event.target.className)
                let test = 2
                let test_2 = Number(23)
                console.log("number.class = " + number.class)
                console.log("test.class = " + test.class)
                console.log("test_2.class = " + test_2.class)

                showOneUsers(number)
            }


        });

        function alarm() {
            console.log("Triggered")
        }

        function alarm_2(event) {
            // вывести тип события, элемент и координаты клика
            console.log(event.type + " on " + event.currentTarget)
            console.log("Coordinate is " + event.clientX + ":" + event.clientY )
            console.log("Triggered")
        }

        function eventUser() {
            console.log("Hello, i am a eventUser function")
        }


        function sendUser() {

            $.ajax({
                url: '/users',
                dataType: 'json',
                type: 'POST',
                cache: false,
                contentType: 'application/json',
                data: JSON.stringify({
                    firstName: $("#user_firstName").val(),
                    lastName: $("#user_lastName").val(),
                    email: $("#user_userEmail").val()
                }),
                success: function () {
                    console.log("New_User (function sendUser())")
                    showUsers()
                }
            })
        }

        function updateUser() {

            $.ajax({
                url: '/users',
                dataType: 'json',
                type: 'PUT',
                cache: false,
                contentType: 'application/json',
                data: JSON.stringify({
                    id: $("#user_id").val(),
                    firstName: $("#user_firstName").val(),
                    lastName: $("#user_lastName").val(),
                    email: $("#user_userEmail").val()
                }),
                success: function () {
                    console.log("Update_User (function updateUser())")
                    showUsers()
                }
            })
        }
/*
        function deleteUser(id) {

            $.delete('/users/{id}', function (data) {

            })
        }*/

        function deleteUser() {
            let id = $("#user_id").val()

            $.ajax({
                url: '/users/' + id,
                dataType: 'json',
                type: 'DELETE',
                cache: false,
                contentType: 'application/json',
                success: function () {
                    console.log("Delete_User (function deleteUser())")
                    showUsers()
                }

            }).fail(function (url) {
                console.log(url);
                console.log("Delete_Fail_User (function deleteUser())")
                showUsers()
            })
        }


        function showOneUser() {
            return $.get('users/60')
        }

        function returnUserById() {
            let id = 60

            let user = $.ajax({
                url: '/users/' + id,
                dataType: 'json',
                type: 'GET',
                cache: false,
                contentType: 'application/json',
                success: function () {
                    console.log("Return_User (function returnUserById())")
                    showUsers()
                }

            }).fail(function (url) {
                console.log(url);
                console.log("Return_Fail_User (function returnUserById())")
                showUsers()
            })

            // return '{ "name": "John", "age": 35, "isAdmin": false, "friends": [0,1,2,3] }';
            return user
        }
    </script>
</head>
<body>
<h1>Welcome to Index PAGE!</h1>

<br/><br/>
<a th:href="@{/logout}">Sign Out</a>

<div id="test_user"></div>
<input type="button" onclick="eventUser()" id="elem" class="37" value="Event" />


<form>
    <input type="text" id="user_id" placeholder="ID" /><br />
    <input type="text" id="user_firstName" placeholder="Name" /><br />
    <input type="text" id="user_lastName" placeholder="LastName" /><br />
    <input type="text" id="user_userEmail" placeholder="Name" /><br />
    <input type="button" onclick="sendUser()" value="Save" />
    <input type="button" onclick="updateUser()" value="Update" />
    <input type="button" onclick="deleteUser()" value="Delete" /><br />
</form>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js" integrity="sha384-w76AqPfDkMBDXo30jS1Sgez6pr3x5MlQ1ZAGC+nuZB+EYdgRZgiwxhTBTkF7CXvN" crossorigin="anonymous"></script>
<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<script src="/js/main.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.3/jquery.min.js"></script>
</body>
</html>